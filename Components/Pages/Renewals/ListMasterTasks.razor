@page "/Renewals/MasterTasks"
@using Mantis.Domain.Renewals.Models
@using Mantis.Domain.Shared.Helpers
@using Syncfusion.Blazor.Grids
@using Syncfusion.Blazor.Navigations
@using Syncfusion.Blazor.Data
@using Syncfusion.Blazor.Inputs
@using Syncfusion.Blazor
@inject DataHelper DataHelper
@rendermode InteractiveServer

<SfBreadcrumb>
    <BreadcrumbItems>
        <BreadcrumbItem Text="Renewals" Url="/Renewals" />
        <BreadcrumbItem Text="Master Tasks" />
    </BreadcrumbItems>
</SfBreadcrumb>

<_toolbar />

<div class="page-content-datagrid">
    <SfGrid @ref="Grid" DataSource="@GridData" AllowPaging="true" AllowSorting="true" ShowColumnChooser="true" 
        Toolbar="@(new List<string>() { "Add", "Edit", "Delete", "Update", "Search", "Cancel", "ColumnChooser" })" RowHeight="30">
        <GridEvents OnActionFailure="@ActionFailure" TValue="TaskMaster"></GridEvents>
        <SfDataManager Url="@getUrl" InsertUrl="@insertUrl" UpdateUrl="@updateUrl" RemoveUrl="@deleteUrl" Adaptor="Adaptors.UrlAdaptor"></SfDataManager>
        <GridEditSettings AllowAdding="true" AllowEditing="true" AllowDeleting="true" Mode="EditMode.Dialog"></GridEditSettings>
        <GridPageSettings PageSize="20"></GridPageSettings>
        <GridColumns>
            <GridColumn Field=@nameof(TaskMaster.Id) HeaderText="Id" ValidationRules="@(new ValidationRules{ Required= true })" IsPrimaryKey="true" IsIdentity="true" Visible="false"></GridColumn>
            <GridColumn Field=@nameof(TaskMaster.TaskName) HeaderText="Name" Width="400"></GridColumn>
            <GridColumn Field=@nameof(TaskMaster.Description) HeaderText="Description"></GridColumn>
            <GridColumn Field=@nameof(TaskMaster.DaysBeforeExpiration) HeaderText="GoalDays"></GridColumn>
            <GridColumn Field=@nameof(TaskMaster.ParentTaskId) HeaderText="Parent Task"></GridColumn>
            <GridColumn Field=@nameof(TaskMaster.ForType) HeaderText="For Type"></GridColumn>
            <GridColumn Field=@nameof(TaskMaster.Important) HeaderText="Important"></GridColumn>
            <GridColumn Field=@nameof(TaskMaster.OrderNumber) HeaderText="Order"></GridColumn>
        </GridColumns>
    </SfGrid>
</div>
@statusMy

@code {
    SfGrid<TaskMaster> Grid { get; set; }
    SfDataManager DataManager { get; set; }
    string statusMy = "Loading";
    public List<TaskMaster> GridData { get; set; }

    private string getUrl;
    private string insertUrl;
    private string updateUrl;
    private string deleteUrl;

    protected override void OnInitialized()
    {
        var baseUrl = DataHelper.GetBaseUrl();
        getUrl = $"{baseUrl}/api/TaskMaster";
        insertUrl = $"{baseUrl}/api/TaskMaster/Insert";
        updateUrl = $"{baseUrl}/api/TaskMaster/Update";
        deleteUrl = $"{baseUrl}/api/TaskMaster/Delete";
    }

    public void ActionFailure(Syncfusion.Blazor.Grids.FailureEventArgs args)
    {
        statusMy = "ERROR ON GRID!<br>";
        statusMy += args.Error.ToString();
        StateHasChanged();
    }
}
